<link rel="stylesheet" href="table.page.scss">
<div class="app-container d-flex mt-5">
  <!-- Sidebar -->
  <!-- N√∫t m·ªü sidebar cho mobile -->
  <button style="margin-top: 50px" class="sidebar-toggle d-md-none" (click)="toggleSidebar()">
    ‚ò∞
  </button>

  <!-- Sidebar -->
  <div style="margin-top: 20px" class="sidebar" [class.sidebar-mobile-visible]="isSidebarVisible">
    <div class="logo">‚òï CoffeeSoft</div>
    <ul class="menu">
      <li routerLink="./admin">H·ªá th·ªëng</li>
      <li routerLink="/admin">DashBoard</li>
      <li routerLink="/users">Nh√¢n Vi√™n</li>
      <li routerLink="/store">C·ª≠a h√†ng</li>
      <li class="active" routerLink="/table">B√†n</li>
      <li routerLink="/discount">Khuy·∫øn m√£i</li>
      <li routerLink="/noibo">N·ªôi B·ªô</li>
      <li routerLink="/order">ƒê·∫∑t v√† Thanh To√°n</li>
      <li routerLink="/report">B√°o c√°o</li>
    </ul>
  </div>


  <!-- Main Content -->
  <div class="main-content flex-fill">

    <!-- Header -->
    <ion-header>
      <ion-toolbar color="primary">
        <ion-title>üìã Qu·∫£n l√Ω B√†n</ion-title>
      </ion-toolbar>
    </ion-header>

    <!-- Container -->
    <div class="container mt-4">
      <h2 class="section-heading">
        <span class="icon">ü™ë</span>
        Danh s√°ch b√†n
      </h2>


      <!-- Danh s√°ch b√†n -->
      <div class="row">
        <div class="col-md-4 col-sm-6 mb-4" *ngFor="let table of tables">
          <div class="card shadow border-0" [ngClass]="{
          'bg-success text-white': table.status === 'Occupied',
          'bg-light': table.status === 'Available'
        }">
            <div class="card-body">
              <h5 class="card-title">ü™ë B√†n s·ªë {{ table.tableNumber }}</h5>
              <p class="card-text">Tr·∫°ng th√°i:
                <span
                  [ngClass]="{'text-warning': table.status === 'Occupied', 'text-success': table.status === 'Available'}">
                {{ table.status === 'Occupied' ? 'ƒêang s·ª≠ d·ª•ng' : 'Tr·ªëng' }}
              </span>
              </p>
              <div class="d-flex justify-content-between flex-wrap gap-2">
                <button class="btn btn-outline btn-sm" (click)="showItems(table.id)">Xem m√≥n</button>
                <button class="btn btn-info btn-sm" (click)="editTable(table)">‚úèÔ∏è S·ª≠a</button>
                <button class="btn btn-danger btn-sm" (click)="deleteTable(table.id)">üóë Xo√°</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- M√≥n ƒÉn theo b√†n -->
      <!-- M√≥n ƒë√£ g·ªçi cho b√†n ƒëang ch·ªçn -->
      <div *ngIf="selectedTableId" class="mt-5">
        <h4>üçΩÔ∏è M√≥n ƒÉn c·ªßa b√†n s·ªë {{ getSelectedTableNumber() }}</h4>

        <ul class="list-group mt-3" *ngIf="tableItems.length > 0; else noOrderItems">
          <li *ngFor="let item of tableItems" class="list-group-item d-flex justify-content-between align-items-center">
            <div>
              <strong>{{ item.name }}</strong><br/>
              <span class="text-muted">Gi√°: {{ item.price | currency:'VND' }}</span><br/>
              <span>
          S·ªë l∆∞·ª£ng:
          <button class="btn btn-sm btn-outline-secondary mx-1" (click)="decreaseQuantity(item)">‚àí</button>
                {{ item.quantity }}
                <button class="btn btn-sm btn-outline-secondary mx-1" (click)="increaseQuantity(item)">+</button>
        </span>
            </div>
            <span class="badge bg-primary rounded-pill">
        {{ item.price * item.quantity | currency:'VND' }}
      </span>
          </li>

          <li class="list-group-item d-flex justify-content-between">
            <strong>T·ªïng c·ªông:</strong>
            <strong>{{ getTotal() | currency:'VND' }}</strong>
          </li>
        </ul>

        <!-- N·∫øu kh√¥ng c√≥ m√≥n n√†o -->
        <ng-template #noOrderItems>
          <p class="text-muted mt-2">Ch∆∞a c√≥ m√≥n n√†o ƒë∆∞·ª£c g·ªçi.</p>
        </ng-template>

        <!-- N√∫t g·ªçi m√≥n v√† thanh to√°n -->
        <div class="d-grid gap-2 mt-3">
          <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#menuModal">
            ‚ûï G·ªçi m√≥n
          </button>
          <button class="btn btn-success" (click)="checkout()">
            üí∞ Thanh to√°n
          </button>
        </div>
      </div>

      <!-- ‚úÖ Modal ch·ªçn m√≥n -->
      <div class="modal fade" id="menuModal" tabindex="-1" aria-labelledby="menuModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
          <div class="modal-content">

            <!-- Header -->
            <div class="modal-header">
              <h5 class="modal-title" id="menuModalLabel">üìã Danh s√°ch m√≥n ƒÉn</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
            </div>

            <!-- Body -->
            <div class="modal-body">

              <!-- ‚úÖ N·∫øu c√≥ m√≥n ƒÉn -->
              <ng-container *ngIf="menuItems && menuItems.length > 0; else loadingOrEmpty">
                <div class="row">
                  <div class="col-md-6 mb-3" *ngFor="let item of menuItems">
                    <div class="card h-100 shadow-sm">
                      <div class="card-body d-flex flex-column">
                        <h5 class="card-title">{{ item.name }}</h5>
                        <p class="card-text">Gi√°: {{ item.price | currency:'VND':'symbol':'1.0-0' }}</p>

                        <button
                          class="btn btn-success mt-auto"
                          (click)="handleCallItem(item)"
                          data-bs-dismiss="modal"
                        >
                          ‚ûï G·ªçi m√≥n
                        </button>

                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>

              <!-- ‚ùå N·∫øu ƒëang t·∫£i ho·∫∑c kh√¥ng c√≥ m√≥n -->
              <ng-template #loadingOrEmpty>
                <div class="text-center py-3 text-muted">
                  <div class="spinner-border text-secondary mb-2" role="status" *ngIf="isLoading"></div>
                  <p *ngIf="!isLoading">Kh√¥ng c√≥ m√≥n n√†o ƒë·ªÉ hi·ªÉn th·ªã.</p>
                </div>
              </ng-template>

            </div>
          </div>
        </div>
      </div>


      <!-- Form th√™m / c·∫≠p nh·∫≠t -->
      <div class="card mt-5 mb-4 p-4 shadow-sm">
        <h5 class="mb-3">{{ editMode ? '‚úèÔ∏è C·∫≠p nh·∫≠t b√†n' : '‚ûï Th√™m b√†n m·ªõi' }}</h5>
        <form (ngSubmit)="editMode ? updateTable() : createTable()">
          <div class="mb-3">
            <label class="form-label">S·ªë b√†n</label>
            <input type="text" class="form-control" [(ngModel)]="newTable.tableNumber" name="tableNumber" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Tr·∫°ng th√°i</label>
            <select class="form-select" [(ngModel)]="newTable.status" name="status">
              <option value="Available">Tr·ªëng</option>
              <option value="Occupied">ƒêang s·ª≠ d·ª•ng</option>
            </select>
          </div>

          <div class="mb-3">
            <label class="form-label">ID C·ª≠a h√†ng</label>
            <input type="text" class="form-control" [(ngModel)]="newTable.storeId" name="storeId" required>
          </div>

          <button type="submit" class="btn btn-success me-2">{{ editMode ? 'L∆∞u thay ƒë·ªïi' : 'Th√™m b√†n' }}</button>
          <button type="button" class="btn btn-secondary" (click)="resetForm()">Hu·ª∑</button>
        </form>
      </div>

    </div>
  </div>

</div>
